<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/angular.js/1.3.9/angular.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/sudoku.css" />
    <link href="./images/favicon.ico" rel="shortcut icon" />
    <title>Sudoku Game</title>
</head>
<body>
<div class="mainbody" ng-app="sudoku" ng-controller="Sudoku">
    <div class="sudoku">
        <div ng-repeat="row in mainbody track by $index">
            <div ng-repeat="column in row track by $index">
                <input type="text" class="mybox" ng-if="column==null&&flag==0"
                       ng-change="check()" ng-model="margin[$parent.$parent.$index][$index]" onkeypress = 'return /^\d$/.test(String.fromCharCode(event.keyCode||event.keycode||event.which))'
                       oninput= 'this.value = this.value.replace(/\D+/g, "")'
                       onpropertychange='if(!/\D+/.test(this.value)){return;};this.value=this.value.replace(/\D+/g, "")'
                       onblur = 'this.value = this.value.replace(/\D+/g, "")' maxlength="1"/>
                <input type="text" class="mybox disable" ng-if="column!=null||flag==1" disabled="disabled"
                       ng-model="margin[$parent.$parent.$index][$index]" />
            </div>
        </div>
    </div>
    <div class="settings">
        <div id="mode">
            难度： <select ng-model="mode" ng-change="changeMode()" ng-options="value.label for value in values"></select>
        </div>
    </div>
</div>
<script>



    var app = angular.module("sudoku", []);
    app.controller("Sudoku", function($scope) {
        var seedArray = [ [ 9, 7, 8, 3, 1, 2, 6, 4, 5 ],
            [ 3, 1, 2, 6, 4, 5, 9, 7, 8 ],
            [ 6, 4, 5, 9, 7, 8, 3, 1, 2 ],
            [ 7, 8, 9, 1, 2, 3, 4, 5, 6 ],
            [ 1, 2, 3, 4, 5, 6, 7, 8, 9 ],
            [ 4, 5, 6, 7, 8, 9, 1, 2, 3 ],
            [ 8, 9, 7, 2, 3, 1, 5, 6, 4 ],
            [ 2, 3, 1, 5, 6, 4, 8, 9, 7 ],
            [ 5, 6, 4, 8, 9, 7, 2, 3, 1 ] ];
        var randomList = creatNineRondomArray();
        var array = creatSudokuArray(seedArray, randomList);
        var solution = angular.copy(array);

        $scope.flag = 0;
        $scope.values = [{
            id: 1,
            label: '简单'
        },{
            id: 2,
            label: '中等'
        },{
            id: 3,
            label: '困难'
        }]

        $scope.mode = $scope.values[0];

        $scope.changeMode = function() {
            $scope.flag = 0;
            randomList = creatNineRondomArray();
            array = creatSudokuArray(seedArray, randomList);
            solution = angular.copy(array);
            if ($scope.mode == $scope.values[0]) {
                var newarray = angular.copy(newSudoku(array, 40));
            } else if ($scope.mode == $scope.values[1]) {
                var newarray = angular.copy(newSudoku(array, 60));
            } else if ($scope.mode == $scope.values[2]) {
                var newarray = angular.copy(newSudoku(array, 80));
            }
            $scope.margin = angular.copy(newarray);
            $scope.mainbody = angular.copy(newarray);
        }
        //var newarray = angular.copy(newSudoku(array, 40));
        if ($scope.mode == $scope.values[0]) {
            var newarray = angular.copy(newSudoku(array, 40));
        } else if ($scope.mode == $scope.values[1]) {
            var newarray = angular.copy(newSudoku(array, 60));
        } else if ($scope.mode == $scope.values[2]) {
            var newarray = angular.copy(newSudoku(array, 80));
        }
        $scope.margin = angular.copy(newarray);
        $scope.mainbody = angular.copy(newarray);
        $scope.check = function() {
            /*for ( var i = 0; i < 9; i++) {
             for ( var j = 0; j < 9; j++) {
             debugger;
             if (solution[i][j] != $scope.margin[i][j]) {
             return false;
             }
             }
             }*/
            for (var i = 0; i < 9; i++) {
                var tmp = ["1","2","3","4","5","6","7","8","9"];
                for (var j = 0; j < 9; j++) {
                    var flag = 0;
                    for (var k = 0; k < 9; k++) {
                        if ($scope.margin[i][j] == tmp[k]) {
                            tmp[k] == 0;
                            flag = 1;
                        }
                    }
                    if (flag == 0) {
                        return false;
                    }
                }
            }

            for (var j = 0; j < 9; j++) {
                var tmp = ["1","2","3","4","5","6","7","8","9"];
                for (var i = 0; i < 9; i++) {
                    var flag = 0;
                    for (var k = 0; k < 9; k++) {
                        if ($scope.margin[i][j] == tmp[k]) {
                            tmp[k] == 0;
                            flag = 1;
                        }
                    }
                    if (flag == 0) {
                        return false;
                    }
                }
            }

            for (var t = 0; t < 9; t++) {
                var mi = (t * 3) % 9;
                var mj = Math.floor((t * 3) / 9) * 3;
                var tmp = ["1","2","3","4","5","6","7","8","9"];
                for (var i = mi; i < mi + 3; i++) {
                    for (var j = mj; j < mj + 3; j++) {
                        var flag = 0;
                        for (var k = 0; k < 9; k++) {
                            if ($scope.margin[i][j] == tmp[k]) {
                                tmp[k] == 0;
                                flag = 1;
                            }
                        }
                        if (flag == 0) {
                            return false;
                        }
                    }
                }
            }
            $scope.flag = 1;
            alert('you win!');
            return true;
        }
        function contains(list, num) {
            for ( var i in list) {
                if (list[i] == num) {
                    return true;
                }
            }
            return false;
        }
        function creatNineRondomArray() {
            var list = [];
            for ( var i = 0; i < 9; i++) {
                var randomNum = Math.round(Math.random() * 8 + 1);
                while (true) {
                    if (!contains(list, randomNum)) {
                        list.push(randomNum);
                        break;
                    }
                    randomNum = Math.round(Math.random() * 8 + 1);
                }
            }
            return list;
        }
        function creatSudokuArray(seedArray, randomList) {
            tmp = angular.copy(seedArray);
            var flag = 1;
            for ( var i = 0; i < 9; i++) {
                for ( var j = 0; j < 9; j++) {
                    for ( var k = 0; k < 9; k++) {
                        if (tmp[i][j] == randomList[k]) {
                            tmp[i][j] = randomList[(k + 1) % 9];
                            break;
                        }
                    }
                }
            }
            return tmp;
        }
        function newSudoku(array, mode) {
            for ( var i = 0; i < mode; i++) {
                var mi = Math.round(Math.random() * 8);
                var mj = Math.round(Math.random() * 8);
                array[mi][mj] = null;
            }
            return array;
        }

        $scope.test = [ [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0 ] ];
    });
</script>
</body>
</html>